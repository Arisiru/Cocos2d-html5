<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<title>CocosJS Source: plugin/texture/TexturePacker.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.cerulean.css">

</head>

<body>
<div class="container-fluid">
	<div class="navbar navbar-fixed-top ">
		<div class="navbar-inner">
			<a class="brand" href="index.html">CocosJS</a>
			<ul class="nav">
				
				<li class="dropdown">
					<a href="namespaces.list.html" class="dropdown-toggle" data-toggle="dropdown">Namespaces<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="global.html#cc">cc</a>
						</li>
						
						<li>
							<a href="global.html#cc#action">cc.action</a>
						</li>
						
						<li>
							<a href="cc.Debug.html">cc.Debug</a>
						</li>
						
						<li>
							<a href="cc.game.html">cc.game</a>
						</li>
						
						<li>
							<a href="cc.input.html">cc.input</a>
						</li>
						
						<li>
							<a href="cc.locale.html">cc.locale</a>
						</li>
						
						<li>
							<a href="cc.math.html">cc.math</a>
						</li>
						
						<li>
							<a href="cc.math.path_.html">cc.math.path</a>
						</li>
						
						<li>
							<a href="cc.node.html">cc.node</a>
						</li>
						
						<li>
							<a href="cc.node.sprite.html">cc.node.sprite</a>
						</li>
						
						<li>
							<a href="cc.plugin.html">cc.plugin</a>
						</li>
						
						<li>
							<a href="cc.plugin.asset.html">cc.plugin.asset</a>
						</li>
						
						<li>
							<a href="cc.plugin.audio.html">cc.plugin.audio</a>
						</li>
						
						<li>
							<a href="cc.plugin.layout.html">cc.plugin.layout</a>
						</li>
						
						<li>
							<a href="cc.plugin.loader.html">cc.plugin.loader</a>
						</li>
						
						<li>
							<a href="cc.plugin.texture.html">cc.plugin.texture</a>
						</li>
						
						<li>
							<a href="cc.render.html">cc.render</a>
						</li>
						
						<li>
							<a href="cc.render.shader.html">cc.render.shader</a>
						</li>
						
						<li>
							<a href="cc.render.WebGLState.html">cc.render.WebGLState</a>
						</li>
						
						<li>
							<a href="cc.transition.html">cc.transition</a>
						</li>
						
						<li>
							<a href="cc.util.html">cc.util</a>
						</li>
						
						<li>
							<a href="cc.widget.html">cc.widget</a>
						</li>
						

					</ul>
				</li>
				
				<li class="dropdown">
					<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="cc.action.Action.html">cc.action.Action</a>
						</li>
						
						<li>
							<a href="cc.action.ActionChainContext.html">cc.action.ActionChainContext</a>
						</li>
						
						<li>
							<a href="cc.action.ActionChainContext_constructor.html">cc.action.ActionChainContext#constructor</a>
						</li>
						
						<li>
							<a href="cc.action.ActionInfo.html">cc.action.ActionInfo</a>
						</li>
						
						<li>
							<a href="cc.action.ActionManager.html">cc.action.ActionManager</a>
						</li>
						
						<li>
							<a href="cc.action.AlphaAction.html">cc.action.AlphaAction</a>
						</li>
						
						<li>
							<a href="cc.action.AnimateAction.html">cc.action.AnimateAction</a>
						</li>
						
						<li>
							<a href="cc.action.Interpolator.html">cc.action.Interpolator</a>
						</li>
						
						<li>
							<a href="cc.action.JumpAction.html">cc.action.JumpAction</a>
						</li>
						
						<li>
							<a href="cc.action.MoveAction.html">cc.action.MoveAction</a>
						</li>
						
						<li>
							<a href="cc.action.ParseInterpolator.html">cc.action.ParseInterpolator</a>
						</li>
						
						<li>
							<a href="cc.action.PathAction.html">cc.action.PathAction</a>
						</li>
						
						<li>
							<a href="cc.action.PropertyAction.html">cc.action.PropertyAction</a>
						</li>
						
						<li>
							<a href="cc.action.PropertyInfo.html">cc.action.PropertyInfo</a>
						</li>
						
						<li>
							<a href="cc.action.RotateAction.html">cc.action.RotateAction</a>
						</li>
						
						<li>
							<a href="cc.action.ScaleAction.html">cc.action.ScaleAction</a>
						</li>
						
						<li>
							<a href="cc.action.SchedulerQueue.html">cc.action.SchedulerQueue</a>
						</li>
						
						<li>
							<a href="cc.action.SchedulerQueueTask.html">cc.action.SchedulerQueueTask</a>
						</li>
						
						<li>
							<a href="cc.action.SequenceAction.html">cc.action.SequenceAction</a>
						</li>
						
						<li>
							<a href="cc.action.TintAction.html">cc.action.TintAction</a>
						</li>
						
						<li>
							<a href="cc.game.Game.html">cc.game.Game</a>
						</li>
						
						<li>
							<a href="cc.input.InputManager.html">cc.input.InputManager</a>
						</li>
						
						<li>
							<a href="cc.input.InputManagerEvent.html">cc.input.InputManagerEvent</a>
						</li>
						
						<li>
							<a href="cc.input.KeyActionInfo.html">cc.input.KeyActionInfo</a>
						</li>
						
						<li>
							<a href="cc.input.KeyboardCursor.html">cc.input.KeyboardCursor</a>
						</li>
						
						<li>
							<a href="cc.input.KeyboardInputManager.html">cc.input.KeyboardInputManager</a>
						</li>
						
						<li>
							<a href="cc.input.KeyInfo.html">cc.input.KeyInfo</a>
						</li>
						
						<li>
							<a href="cc.input.MouseInputManager.html">cc.input.MouseInputManager</a>
						</li>
						
						<li>
							<a href="cc.input.MouseInputManagerEvent.html">cc.input.MouseInputManagerEvent</a>
						</li>
						
						<li>
							<a href="cc.input.PriorityInputNode.html">cc.input.PriorityInputNode</a>
						</li>
						
						<li>
							<a href="cc.input.SceneGraphInputTreeNode.html">cc.input.SceneGraphInputTreeNode</a>
						</li>
						
						<li>
							<a href="cc.math.Color.html">cc.math.Color</a>
						</li>
						
						<li>
							<a href="cc.math.Dimension.html">cc.math.Dimension</a>
						</li>
						
						<li>
							<a href="cc.math.Matrix3.html">cc.math.Matrix3</a>
						</li>
						
						<li>
							<a href="cc.math.Path.html">cc.math.Path</a>
						</li>
						
						<li>
							<a href="cc.math.path.ContainerSegment.html">cc.math.path.ContainerSegment</a>
						</li>
						
						<li>
							<a href="cc.math.path.SegmentArc.html">cc.math.path.SegmentArc</a>
						</li>
						
						<li>
							<a href="cc.math.path.SegmentBezier.html">cc.math.path.SegmentBezier</a>
						</li>
						
						<li>
							<a href="cc.math.path.SegmentCardinalSpline.html">cc.math.path.SegmentCardinalSpline</a>
						</li>
						
						<li>
							<a href="cc.math.path_.html#SegmentLine">cc.math.path.SegmentLine</a>
						</li>
						
						<li>
							<a href="cc.math.path.SegmentQuadratic.html">cc.math.path.SegmentQuadratic</a>
						</li>
						
						<li>
							<a href="cc.math.path.SubPath.html">cc.math.path.SubPath</a>
						</li>
						
						<li>
							<a href="cc.math.Rectangle.html">cc.math.Rectangle</a>
						</li>
						
						<li>
							<a href="cc.math.Vector.html">cc.math.Vector</a>
						</li>
						
						<li>
							<a href="cc.node.Director.html">cc.node.Director</a>
						</li>
						
						<li>
							<a href="cc.node.FastSprite.html">cc.node.FastSprite</a>
						</li>
						
						<li>
							<a href="cc.node.Node.html">cc.node.Node</a>
						</li>
						
						<li>
							<a href="cc.node.Scene.html">cc.node.Scene</a>
						</li>
						
						<li>
							<a href="cc.node.Sprite_.html">cc.node.Sprite</a>
						</li>
						
						<li>
							<a href="cc.node.sprite.Animation.html">cc.node.sprite.Animation</a>
						</li>
						
						<li>
							<a href="cc.node.sprite.AnimationCache.html">cc.node.sprite.AnimationCache</a>
						</li>
						
						<li>
							<a href="cc.node.sprite.SpriteFrame.html">cc.node.sprite.SpriteFrame</a>
						</li>
						
						<li>
							<a href="cc.plugin.asset.AssetManager.html">cc.plugin.asset.AssetManager</a>
						</li>
						
						<li>
							<a href="cc.plugin.audio.AudioEffect.html">cc.plugin.audio.AudioEffect</a>
						</li>
						
						<li>
							<a href="cc.plugin.audio.AudioManager.html">cc.plugin.audio.AudioManager</a>
						</li>
						
						<li>
							<a href="cc.plugin.font.FontMetrics.html">cc.plugin.font.FontMetrics</a>
						</li>
						
						<li>
							<a href="cc.plugin.font.SpriteFont.html">cc.plugin.font.SpriteFont</a>
						</li>
						
						<li>
							<a href="cc.plugin.font.SpriteFontChar.html">cc.plugin.font.SpriteFontChar</a>
						</li>
						
						<li>
							<a href="cc.plugin.layout.BorderLayout.html">cc.plugin.layout.BorderLayout</a>
						</li>
						
						<li>
							<a href="cc.plugin.layout.Gap.html">cc.plugin.layout.Gap</a>
						</li>
						
						<li>
							<a href="cc.plugin.layout.GridLayout.html">cc.plugin.layout.GridLayout</a>
						</li>
						
						<li>
							<a href="cc.plugin.layout.Insets.html">cc.plugin.layout.Insets</a>
						</li>
						
						<li>
							<a href="cc.plugin.layout.LayerLayout.html">cc.plugin.layout.LayerLayout</a>
						</li>
						
						<li>
							<a href="cc.plugin.layout.Layout.html">cc.plugin.layout.Layout</a>
						</li>
						
						<li>
							<a href="cc.plugin.layout.Unit.html">cc.plugin.layout.Unit</a>
						</li>
						
						<li>
							<a href="cc.plugin.loader.Loader.html">cc.plugin.loader.Loader</a>
						</li>
						
						<li>
							<a href="cc.plugin.loader.ResourceLoaderAudioBuffer.html">cc.plugin.loader.ResourceLoaderAudioBuffer</a>
						</li>
						
						<li>
							<a href="cc.plugin.loader.ResourceLoaderImage.html">cc.plugin.loader.ResourceLoaderImage</a>
						</li>
						
						<li>
							<a href="cc.plugin.loader.ResourceLoaderJSON.html">cc.plugin.loader.ResourceLoaderJSON</a>
						</li>
						
						<li>
							<a href="cc.plugin.loader.ResourceLoaderXML.html">cc.plugin.loader.ResourceLoaderXML</a>
						</li>
						
						<li>
							<a href="cc.plugin.texture.TexturePacker.html">cc.plugin.texture.TexturePacker</a>
						</li>
						
						<li>
							<a href="cc.plugin.texture.TexturePackerNode.html">cc.plugin.texture.TexturePackerNode</a>
						</li>
						
						<li>
							<a href="cc.plugin.texture.TexturePackerPage.html">cc.plugin.texture.TexturePackerPage</a>
						</li>
						
						<li>
							<a href="cc.render.CanvasRenderer.html">cc.render.CanvasRenderer</a>
						</li>
						
						<li>
							<a href="cc.render.DecoratedWebGLRenderingContext.html">cc.render.DecoratedWebGLRenderingContext</a>
						</li>
						
						<li>
							<a href="cc.render.GeometryBatcher.html">cc.render.GeometryBatcher</a>
						</li>
						
						<li>
							<a href="cc.render.Pattern.html">cc.render.Pattern</a>
						</li>
						
						<li>
							<a href="cc.render.Renderer.html">cc.render.Renderer</a>
						</li>
						
						<li>
							<a href="cc.render.RenderingContextSnapshot.html">cc.render.RenderingContextSnapshot</a>
						</li>
						
						<li>
							<a href="cc.render.ScaleManager.html">cc.render.ScaleManager</a>
						</li>
						
						<li>
							<a href="cc.render.shader.AbstractShader.html">cc.render.shader.AbstractShader</a>
						</li>
						
						<li>
							<a href="cc.render.shader.Attribute.html">cc.render.shader.Attribute</a>
						</li>
						
						<li>
							<a href="cc.render.shader.MatrixUniform.html">cc.render.shader.MatrixUniform</a>
						</li>
						
						<li>
							<a href="cc.render.shader.SolidColorShader.html">cc.render.shader.SolidColorShader</a>
						</li>
						
						<li>
							<a href="cc.render.shader.TextureShader.html">cc.render.shader.TextureShader</a>
						</li>
						
						<li>
							<a href="cc.render.shader.TextureUniform.html">cc.render.shader.TextureUniform</a>
						</li>
						
						<li>
							<a href="cc.render.shader.Uniform.html">cc.render.shader.Uniform</a>
						</li>
						
						<li>
							<a href="cc.render.Texture2D.html">cc.render.Texture2D</a>
						</li>
						
						<li>
							<a href="cc.render.WebGLRenderer.html">cc.render.WebGLRenderer</a>
						</li>
						
						<li>
							<a href="cc.transition.Transition.html">cc.transition.Transition</a>
						</li>
						
						<li>
							<a href="cc.transition.TransitionFade.html">cc.transition.TransitionFade</a>
						</li>
						
						<li>
							<a href="cc.transition.TransitionMove.html">cc.transition.TransitionMove</a>
						</li>
						
						<li>
							<a href="cc.transition.TransitionSlideInB.html">cc.transition.TransitionSlideInB</a>
						</li>
						
						<li>
							<a href="cc.transition.TransitionSlideInL.html">cc.transition.TransitionSlideInL</a>
						</li>
						
						<li>
							<a href="cc.transition.TransitionSlideInR.html">cc.transition.TransitionSlideInR</a>
						</li>
						
						<li>
							<a href="cc.transition.TransitionSlideInT.html">cc.transition.TransitionSlideInT</a>
						</li>
						
						<li>
							<a href="cc.util.Resource.html">cc.util.Resource</a>
						</li>
						
						<li>
							<a href="cc.widget.Button.html">cc.widget.Button</a>
						</li>
						
						<li>
							<a href="cc.widget.Label.html">cc.widget.Label</a>
						</li>
						

					</ul>
				</li>
				
				<li class="dropdown">
					<a href="global.html" class="dropdown-toggle" data-toggle="dropdown">Global<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="global.html#__extends">__extends</a>
						</li>
						
						<li>
							<a href="global.html#test">test</a>
						</li>
						

					</ul>
				</li>
				
			</ul>
		</div>
	</div>

	<div class="row-fluid">

		
			<div class="span12">
				
				<div id="main">
					


		<h1 class="page-title">Source: plugin/texture/TexturePacker.js</h1>
    
<section>
	<article>
		<pre
			class="sunlight-highlight-javascript linenums">/**
 * License: see license.txt file.
 */
/// &lt;reference path="../../math/Dimension.ts"/>
/// &lt;reference path="../../node/sprite/SpriteFrame.ts"/>
/// &lt;reference path="../../render/Texture2D"/>
/// &lt;reference path="../../render/RenderingContext"/>
/// &lt;reference path="../asset/AssetManager.ts"/>
var cc;
(function (cc) {
    var plugin;
    (function (plugin) {
        var texture;
        (function (texture) {
            "use strict";
            var getTexturePageIndex = function () {
                var index = 0;
                return function () {
                    return index++;
                };
            }();
            var SortStrategies = {
                __compare: function (v0, v1) {
                    if (v0 &lt; v1) {
                        return 1;
                    }
                    else if (v0 > v1) {
                        return -1;
                    }
                    return 0;
                },
                perimeter: function (i0, i1) {
                    var w0 = i0.getWidth();
                    var h0 = i0.getHeight();
                    var w1 = i1.getWidth();
                    var h1 = i1.getHeight();
                    return SortStrategies.__compare(w0 + w0 + h0 + h0, w1 + w1 + h1 + h1);
                },
                area: function (i0, i1) {
                    var w0 = i0.getWidth();
                    var h0 = i0.getHeight();
                    var w1 = i1.getWidth();
                    var h1 = i1.getHeight();
                    return SortStrategies.__compare(w0 * h0, w1 * h1);
                },
                width: function (i0, i1) {
                    return SortStrategies.__compare(i0.getWidth(), i1.getHeight());
                },
                height: function (i0, i1) {
                    return SortStrategies.__compare(i0.getWidth(), i1.getHeight());
                }
            };
            /**
             * @class cc.plugin.texture.TexturePackerNode
             * @classdesc
             *
             * This Object is a helper for a TexturePackerPage object. It represents a region on a packed image.
             * This object is a actually a binary tree.
             * It will either hold an Image, or two descendant nodes.
             *
             */
            var TexturePackerNode = (function () {
                /**
                 * Create anew TexturePackerNode object instance.
                 * @method cc.plugin.texture.TexturePackerNode#constructor
                 */
                function TexturePackerNode() {
                    /**
                     * x position in page.
                     * @member cc.plugin.texture.TexturePackerNode#_x
                     * @type {number}
                     * @private
                     */
                    this._x = 0;
                    /**
                     * y position in page.
                     * @member cc.plugin.texture.TexturePackerNode#_y
                     * @type {number}
                     * @private
                     */
                    this._y = 0;
                    /**
                     * node width in page.
                     * @member cc.plugin.texture.TexturePackerNode#_width
                     * @type {number}
                     * @private
                     */
                    this._width = 0;
                    /**
                     * node height in page.
                     * @member cc.plugin.texture.TexturePackerNode#_height
                     * @type {number}
                     * @private
                     */
                    this._height = 0;
                    /**
                     * Left child node.
                     * @member cc.plugin.texture.TexturePackerNode#_left
                     * @type {cc.plugin.texture.TexturePackerNode}
                     * @private
                     */
                    this._left = null;
                    /**
                     * right child node.
                     * @member cc.plugin.texture.TexturePackerNode#_right
                     * @type {cc.plugin.texture.TexturePackerNode}
                     * @private
                     */
                    this._right = null;
                    /**
                     * Item this node contains. The item is a pair of Image/Canvas and an id.
                     * @member cc.plugin.texture.TexturePackerNode#_item
                     * @type {{any,string}
                     * @private
                     */
                    this._item = null;
                }
                /**
                 * Insert a Node in this node with the given size.
                 * The function will recursively traverse in-order the node to find the most suitable place to insert.
                 * It will eventually create child nodes as needed.
                 *
                 * @param w {number}
                 * @param h {height}
                 * @param margin {Array&lt;number>=} an array describing a margin around the node. array index are: left, top, right, bottom
                 * @returns {cc.plugin.texture.TexturePackerNode}
                 */
                TexturePackerNode.prototype.insert = function (w, h, margin) {
                    var marginw = margin[0] + margin[2];
                    var marginh = margin[1] + margin[3];
                    if (this._left) {
                        var node = this._left.insert(w, h, margin);
                        return null === node ? this._right.insert(w, h, margin) : node;
                    }
                    else {
                        // node has been assigned ? no further search
                        if (this._item !== null) {
                            return null;
                        }
                        // does not fit here
                        if (this._width &lt; w || this._height &lt; h) {
                            // return signal to try in another node
                            return null;
                        }
                        else if (this._width === w &amp;&amp; this._height === h) {
                            // perfect match. return this, w/o further dividing
                            return this;
                        }
                        else {
                            // create descendants
                            this._left = new TexturePackerNode();
                            this._right = new TexturePackerNode();
                            // when substracting the desired area, it is wider than taller ?
                            // create children maximizing available area.
                            if (this._width - w >= this._height - h) {
                                // divide vertically
                                this._left._x = this._x;
                                this._left._y = this._y;
                                this._left._width = w;
                                this._left._height = this._height;
                                //this._right._x= this._x + w;
                                this._right._x = this._x + w + marginw;
                                this._right._y = this._y;
                                //this._right._width= this._width - w;
                                this._right._width = this._width - w - marginw;
                                this._right._height = this._height;
                            }
                            else {
                                // divide horizontally
                                this._left._x = this._x;
                                this._left._y = this._y;
                                this._left._width = this._width;
                                this._left._height = h;
                                this._right._x = this._x;
                                //this._right._y= this._y + h;
                                this._right._y = this._y + h + marginh;
                                this._right._width = this._width;
                                //this._right._height= this._height - h;
                                this._right._height = this._height - h - marginh;
                            }
                            return this._left.insert(w, h, margin);
                        }
                    }
                };
                /**
                 * Paint this node and all its descendants.
                 * @method cc.plugin.texture.TexturePackerNode#paint
                 * @param ctx {CanvasRenderingContext2D}
                 * @param margin {Array&lt;number>=} an array describing a margin around the node. array index are: left, top, right, bottom
                 * @param debug {boolean} draw debug info: a red crossed-rect for empty nodes, and a white rect around packed
                 * images.
                 */
                TexturePackerNode.prototype.paint = function (ctx, margin, debug) {
                    if (debug) {
                        // DEBUG rects.
                        if (this._item) {
                            ctx.strokeStyle = "#fff";
                            ctx.strokeRect(this._x + .5, this._y + .5, this._width - 1, this._height - 1);
                        }
                        else if (!this._left) {
                            ctx.strokeStyle = "#f00";
                            ctx.lineWidth = 1;
                            ctx.strokeRect(this._x + .5, this._y + .5, this._width - 1, this._height - 1);
                            ctx.beginPath();
                            ctx.moveTo(this._x + .5, this._y + .5);
                            ctx.lineTo(this._x + this._width - .5, this._y + this._height - .5);
                            ctx.moveTo(this._x + this._width - .5, this._y + .5);
                            ctx.lineTo(this._x + .5, this._y + this._height - .5);
                            ctx.stroke();
                        }
                    }
                    if (this._item) {
                        this._item.draw(ctx, this._x, this._y);
                    }
                    if (this._left) {
                        this._left.paint(ctx, margin, debug);
                    }
                    if (this._right) {
                        this._right.paint(ctx, margin, debug);
                    }
                };
                /**
                 * Create and add to the AssetManager a SpriteFrame for each node in the tree that has an associated image.
                 * The SpriteFrames will be created using the SpriteFrame that corresponds to the textureId parameter.
                 * @method cc.plugin.texture.TexturePackerNode#createFrames
                 * @param textureId {string}
                 */
                TexturePackerNode.prototype.createFrames = function (textureId) {
                    if (this._item) {
                        cc.plugin.asset.AssetManager.addSpriteFrame(cc.plugin.asset.AssetManager.getSpriteFrame(textureId).createSubSpriteFrame(this._x, this._y, this._width, this._height, this._item.getId()));
                    }
                    if (this._left) {
                        this._left.createFrames(textureId);
                    }
                    if (this._right) {
                        this._right.createFrames(textureId);
                    }
                };
                return TexturePackerNode;
            })();
            texture.TexturePackerNode = TexturePackerNode;
            /**
             * @class cc.plugin.texture.TexturePackerPage
             * @classdesc
             *
             * This object creates an on-the-fly Image atlas with the Images that best fit in it.
             * Internally keeps a Tree of Nodes to maintain the Atlas image representation.
             * When requested, it will create a canvas object with all the images drawn in it in a non-overlapping manner.
             * Images can (and should) have a margin around them of at least 1 pixel.
             *
             */
            var TexturePackerPage = (function () {
                /**
                 * Create a new TexturePackerPage object instance.
                 * @method {cc.plugin.texture.TexturePackerPage#constructor}
                 * @param id {string}
                 * @param w {number}
                 * @param h {number}
                 */
                function TexturePackerPage(id, w, h) {
                    /**
                     * Canvas with packer images.
                     * @member cc.plugin.texture.TexturePackerPage#_canvas
                     * @type {null}
                     * @private
                     */
                    this._canvas = null;
                    /**
                     * Canvas rendering context.
                     * @member cc.plugin.texture.TexturePackerPage#_ctx
                     * @type {CanvasRenderingContext2D}
                     * @private
                     */
                    this._ctx = null;
                    /**
                     * This tree keeps the regions for each image.
                     * @member {cc.plugin.texture.TexturePackerPage#_root}
                     * @type {cc.plugin.texture.TexturePackerNode}
                     * @private
                     */
                    this._root = null;
                    this._id = id;
                    this._width = w;
                    this._height = h;
                    this._root = new TexturePackerNode();
                    this._root._width = w;
                    this._root._height = h;
                }
                /**
                 * Insert an image in the best place for it in the node's tree.
                 * @method {cc.plugin.texture.TexturePackerPage#insertImage}
                 * @param item {{any,string}} a pair of image/canvas and an id
                 * @param margin {Array&lt;number>=} an array describing a margin around the node. array index are: left, top, right, bottom
                 * @returns {cc.plugin.texture.TexturePackerNode}
                 */
                TexturePackerPage.prototype.insertImage = function (item, margin) {
                    var node = this._root.insert(item.getWidth(), item.getHeight(), margin);
                    if (null !== node) {
                        node._item = item;
                    }
                    return node;
                };
                /**
                 * Create page's assets and adds them to the AssetManager.
                 * @method cc.plugin.texture.TexturePackerPage#createAssets
                 */
                TexturePackerPage.prototype.createAssets = function (margin, debug) {
                    // create a canvas.
                    this._canvas = document.createElement("canvas");
                    this._canvas.width = this._width;
                    this._canvas.height = this._height;
                    this._ctx = this._canvas.getContext("2d");
                    // draw nodes.
                    this._root.paint(this._ctx, margin, debug);
                    // create texture
                    cc.plugin.asset.AssetManager.addImage(this._canvas, this._id);
                    // add all SpriteFrames
                    this._root.createFrames(this._id);
                };
                return TexturePackerPage;
            })();
            texture.TexturePackerPage = TexturePackerPage;
            var TexturePackerItemImage = (function () {
                function TexturePackerItemImage(image, id) {
                    this.image = image;
                    this.id = id;
                }
                TexturePackerItemImage.prototype.getId = function () {
                    return this.id;
                };
                TexturePackerItemImage.prototype.getWidth = function () {
                    return this.image.width;
                };
                TexturePackerItemImage.prototype.getHeight = function () {
                    return this.image.height;
                };
                TexturePackerItemImage.prototype.fits = function (w, h) {
                    return this.image.width &lt;= w &amp;&amp; this.image.height &lt;= h;
                };
                TexturePackerItemImage.prototype.draw = function (ctx, x, y) {
                    ctx.drawImage(this.image, x, y);
                };
                return TexturePackerItemImage;
            })();
            var TexturePackerItemSpriteFrame = (function () {
                function TexturePackerItemSpriteFrame(frame, id) {
                    this.frame = frame;
                    this.id = id;
                }
                TexturePackerItemSpriteFrame.prototype.getId = function () {
                    return this.id;
                };
                TexturePackerItemSpriteFrame.prototype.getWidth = function () {
                    return this.frame.getWidth();
                };
                TexturePackerItemSpriteFrame.prototype.getHeight = function () {
                    return this.frame.getHeight();
                };
                TexturePackerItemSpriteFrame.prototype.fits = function (w, h) {
                    return this.frame.getWidth() &lt;= w &amp;&amp; this.frame.getHeight() &lt;= h;
                };
                TexturePackerItemSpriteFrame.prototype.draw = function (ctx, x, y) {
                    ctx.save();
                    var w = this.frame.getWidth();
                    var h = this.frame.getHeight();
                    var rect = this.frame._rect;
                    if (this.frame._rotated) {
                        ctx.translate(w / 2, h / 2);
                        ctx.rotate(-Math.PI / 2);
                        ctx.translate(-w / 2, -h / 2);
                    }
                    //if ( cc.render.RENDER_ORIGIN==="" )
                    ctx.drawImage(this.frame._texture._image, rect.x, rect.y, rect.w, rect.h, x, y, w, h);
                    ctx.restore();
                };
                return TexturePackerItemSpriteFrame;
            })();
            /**
             * @class cc.plugin.texture.TexturePacker
             * @classdesc
             *
             * This class is a very simple yet effective TexturePacker. It will create images of a user-defined size
             * and pack images in them.
             *
             * The process is:
             * &lt;li>Add images to the packer. Each image must have an id associated.
             * &lt;li>call pack. This will create page object and the tree of nodes with image references.
             * &lt;li>call createAssets, that creates the Page Images and packs the supplied images on them. It also creates
             *   necessary SpriteFrames and Texture objects.
             *
             * This packer is not expected to be used with dynamic textures, adding and removing textures on-the-fly.
             *
             * Images that don't fit in the specified texture page size will be silently discarded.
             *
             */
            var TexturePacker = (function () {
                /**
                 * Create a new TexturePacker object instance.
                 * @method cc.plugin.texture.TexturePacker#constructor
                 */
                function TexturePacker() {
                    /**
                     * An array of pair Image,id with images to pack.
                     * @member cc.plugin.texture.TexturePacker#_images
                     * @type {Array&lt;{any,string}>}
                     * @private
                     */
                    this._images = [];
                    /**
                     * An array of generated texture page object.
                     * @member cc.plugin.texture.TexturePacker#_pages
                     * @type {Array&lt;cc.plugin.texture.TexturePackerPage>}
                     * @private
                     */
                    this._pages = [];
                    this._margin = [0, 0, 0, 0];
                    this._debug = false;
                }
                /**
                 * Add an image with associated id to pack.
                 * @method cc.plugin.texture.TexturePacker#addImage
                 * @param image {HTMLImageElement|HTMLCanvasElement}
                 * @param id {string}
                 */
                TexturePacker.prototype.addImage = function (image, id) {
                    this._images.push(new TexturePackerItemImage(image, id ? id : image.src));
                };
                TexturePacker.prototype.addSpriteFrame = function (spriteFrame) {
                    this._images.push(new TexturePackerItemSpriteFrame(spriteFrame, spriteFrame._name));
                };
                TexturePacker.prototype.addSpriteFrames = function (spriteFrames) {
                    for (var i = 0; i &lt; spriteFrames.length; i++) {
                        this.addSpriteFrame(spriteFrames[i]);
                    }
                };
                TexturePacker.prototype.addPListAtlas = function (image, atlasInfo) {
                    var main = new cc.node.sprite.SpriteFrame(new cc.render.Texture2D(image, ""));
                    var sf = main.createSpriteFramesFromPLIST(atlasInfo);
                    this.addSpriteFrames(sf);
                };
                TexturePacker.prototype.addJSONAtlas = function (image, atlasInfo) {
                    var main = new cc.node.sprite.SpriteFrame(new cc.render.Texture2D(image, ""));
                    var sf = main.createSpriteFramesFromJSON(atlasInfo);
                    this.addSpriteFrames(sf);
                };
                /**
                 * Pack images.
                 * This method ONLY creates the internal TexturePackerPage nodes, not the images.
                 * Images will be packed in pages of the specified size.
                 * @method cc.plugin.texture.TexturePacker#pack
                 * @param pack {cc.plugin.texture.PackInfo} texture packer packing info.
                 */
                TexturePacker.prototype.pack = function (pack) {
                    var w = pack.width || 2048;
                    var h = pack.height || 2048;
                    var sortStrategy = pack.sortBy;
                    var margin_v = pack.margin || 0;
                    // left top right bottom
                    var margin = [margin_v, margin_v, margin_v, margin_v];
                    if (pack['margin-left']) {
                        margin[0] = pack['margin-left'];
                    }
                    if (pack['margin-top']) {
                        margin[1] = pack['margin-top'];
                    }
                    if (pack['margin-right']) {
                        margin[2] = pack['margin-right'];
                    }
                    if (pack['margin-bottom']) {
                        margin[3] = pack['margin-bottom'];
                    }
                    this._debug = typeof pack.debug !== "undefined" ? pack.debug : false;
                    this._margin = margin;
                    this._pages = [];
                    if (sortStrategy) {
                        var ss = SortStrategies[sortStrategy] || SortStrategies['perimeter'];
                        this._images.sort(ss);
                    }
                    this._pages.push(new TexturePackerPage("texturepage" + getTexturePageIndex(), w, h));
                    for (var i = 0; i &lt; this._images.length; i++) {
                        if (this._images[i].fits(w, h)) {
                            var node = null;
                            for (var j = 0; j &lt; this._pages.length; j++) {
                                node = this._pages[j].insertImage(this._images[i], margin);
                                if (node !== null) {
                                    break;
                                }
                            }
                            // not a valid insertion node in the currently created pages.
                            // create a new one (the image fits in page dimensions after all)
                            if (null === node) {
                                var newPage = new TexturePackerPage("texturepage" + getTexturePageIndex(), w, h);
                                this._pages.push(newPage);
                                newPage.insertImage(this._images[i], margin);
                            }
                        }
                    }
                };
                /**
                 * Builds page images and the associated SpriteFrame and Texture2D objects.
                 * Will also add the assets to the AssetManager.
                 * Added images will register a SpriteFrame identified by the supplied id or the image.src if it was not set.
                 * Added sprite frames will register a SpriteFrame identified by its id.
                 * Created Texture pages will register a SpriteFrame identified as texturepage&lt;i>, where i is the sequence
                 * of the created page.
                 * This TexturePage index grows with every created frame, so don't always expect to habe texturepage0 as the
                 * first created page.
                 * @method cc.plugin.texture.TexturePacker#createAssets
                 */
                TexturePacker.prototype.createAssets = function () {
                    for (var i = 0; i &lt; this._pages.length; i++) {
                        this._pages[i].createAssets(this._margin, this._debug);
                    }
                };
                return TexturePacker;
            })();
            texture.TexturePacker = TexturePacker;
        })(texture = plugin.texture || (plugin.texture = {}));
    })(plugin = cc.plugin || (cc.plugin = {}));
})(cc || (cc = {}));
</pre>
	</article>
</section>





				</div>

				<div class="clearfix"></div>
				<footer>
					
					@hyperandroid
					<br />
					
					
		<span class="copyright">
		Chukong inc. 2014
		</span>
					<br />
					
		<span class="jsdoc-message">
		Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha5</a>
		on 23/Tu/2015 using the <a
			href="https://github.com/terryweiss/docstrap">DocStrap template</a>.
		</span>
				</footer>
			</div>

			
			<br clear="both">
		</div>

	</div>
	<!--<script src="scripts/sunlight.js"></script>-->
	<script src="scripts/docstrap.lib.js"></script>
	<script src="scripts/bootstrap-dropdown.js"></script>
	<script src="scripts/toc.js"></script>

	<script>
		$( function () {
			$( "[id*='$']" ).each( function () {
				var $this = $( this );

				$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
			} );

			$( "#toc" ).toc( {
				anchorName  : function ( i, heading, prefix ) {
					return $( heading ).attr( "id" ) || ( prefix + i );
				},
				selectors   : "h1,h2,h3,h4",
				showAndHide : false,
				scrollTo    : "100px"
			} );

			$( "#toc>ul" ).addClass( "nav nav-pills nav-stacked" );
			$( "#main span[id^='toc']" ).addClass( "toc-shim" );
			$( '.dropdown-toggle' ).dropdown();
//			$( ".tutorial-section pre, .readme-section pre" ).addClass( "sunlight-highlight-javascript" ).addClass( "linenums" );

			$( ".tutorial-section pre, .readme-section pre" ).each( function () {
				var $this = $( this );

				var example = $this.find( "code" );
				exampleText = example.html();
				var lang = /{@lang (.*?)}/.exec( exampleText );
				if ( lang && lang[1] ) {
					exampleText = exampleText.replace( lang[0], "" );
					example.html( exampleText );
					lang = lang[1];
				} else {
					lang = "javascript";
				}

				if ( lang ) {

					$this
						.addClass( "sunlight-highlight-" + lang )
						.addClass( "linenums" )
						.html( example.html() );

				}
			} );

			Sunlight.highlightAll( {
				lineNumbers : true,
				showMenu : true,
				enableDoclinks : true
			} );
		} );
	 </script>



	<!--Navigation and Symbol Display-->
	


	<!--Google Analytics-->
	

</body>
</html>
