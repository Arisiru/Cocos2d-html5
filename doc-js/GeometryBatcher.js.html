<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<title>CocosJS Source: render/GeometryBatcher.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.cerulean.css">

</head>

<body>
<div class="container-fluid">
	<div class="navbar navbar-fixed-top ">
		<div class="navbar-inner">
			<a class="brand" href="index.html">CocosJS</a>
			<ul class="nav">
				
				<li class="dropdown">
					<a href="namespaces.list.html" class="dropdown-toggle" data-toggle="dropdown">Namespaces<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="global.html#cc">cc</a>
						</li>
						
						<li>
							<a href="global.html#cc#action">cc.action</a>
						</li>
						
						<li>
							<a href="cc.Debug.html">cc.Debug</a>
						</li>
						
						<li>
							<a href="cc.game.html">cc.game</a>
						</li>
						
						<li>
							<a href="cc.input.html">cc.input</a>
						</li>
						
						<li>
							<a href="cc.locale.html">cc.locale</a>
						</li>
						
						<li>
							<a href="cc.math.html">cc.math</a>
						</li>
						
						<li>
							<a href="cc.math.path_.html">cc.math.path</a>
						</li>
						
						<li>
							<a href="cc.node.html">cc.node</a>
						</li>
						
						<li>
							<a href="cc.node.sprite.html">cc.node.sprite</a>
						</li>
						
						<li>
							<a href="cc.plugin.html">cc.plugin</a>
						</li>
						
						<li>
							<a href="cc.plugin.asset.html">cc.plugin.asset</a>
						</li>
						
						<li>
							<a href="cc.plugin.audio.html">cc.plugin.audio</a>
						</li>
						
						<li>
							<a href="cc.plugin.layout.html">cc.plugin.layout</a>
						</li>
						
						<li>
							<a href="cc.plugin.loader.html">cc.plugin.loader</a>
						</li>
						
						<li>
							<a href="cc.plugin.texture.html">cc.plugin.texture</a>
						</li>
						
						<li>
							<a href="cc.render.html">cc.render</a>
						</li>
						
						<li>
							<a href="cc.render.shader.html">cc.render.shader</a>
						</li>
						
						<li>
							<a href="cc.render.WebGLState.html">cc.render.WebGLState</a>
						</li>
						
						<li>
							<a href="cc.transition.html">cc.transition</a>
						</li>
						
						<li>
							<a href="cc.util.html">cc.util</a>
						</li>
						
						<li>
							<a href="cc.widget.html">cc.widget</a>
						</li>
						

					</ul>
				</li>
				
				<li class="dropdown">
					<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="cc.action.Action.html">cc.action.Action</a>
						</li>
						
						<li>
							<a href="cc.action.ActionChainContext.html">cc.action.ActionChainContext</a>
						</li>
						
						<li>
							<a href="cc.action.ActionChainContext_constructor.html">cc.action.ActionChainContext#constructor</a>
						</li>
						
						<li>
							<a href="cc.action.ActionInfo.html">cc.action.ActionInfo</a>
						</li>
						
						<li>
							<a href="cc.action.ActionManager.html">cc.action.ActionManager</a>
						</li>
						
						<li>
							<a href="cc.action.AlphaAction.html">cc.action.AlphaAction</a>
						</li>
						
						<li>
							<a href="cc.action.AnimateAction.html">cc.action.AnimateAction</a>
						</li>
						
						<li>
							<a href="cc.action.Interpolator.html">cc.action.Interpolator</a>
						</li>
						
						<li>
							<a href="cc.action.JumpAction.html">cc.action.JumpAction</a>
						</li>
						
						<li>
							<a href="cc.action.MoveAction.html">cc.action.MoveAction</a>
						</li>
						
						<li>
							<a href="cc.action.ParseInterpolator.html">cc.action.ParseInterpolator</a>
						</li>
						
						<li>
							<a href="cc.action.PathAction.html">cc.action.PathAction</a>
						</li>
						
						<li>
							<a href="cc.action.PropertyAction.html">cc.action.PropertyAction</a>
						</li>
						
						<li>
							<a href="cc.action.PropertyInfo.html">cc.action.PropertyInfo</a>
						</li>
						
						<li>
							<a href="cc.action.RotateAction.html">cc.action.RotateAction</a>
						</li>
						
						<li>
							<a href="cc.action.ScaleAction.html">cc.action.ScaleAction</a>
						</li>
						
						<li>
							<a href="cc.action.SchedulerQueue.html">cc.action.SchedulerQueue</a>
						</li>
						
						<li>
							<a href="cc.action.SchedulerQueueTask.html">cc.action.SchedulerQueueTask</a>
						</li>
						
						<li>
							<a href="cc.action.SequenceAction.html">cc.action.SequenceAction</a>
						</li>
						
						<li>
							<a href="cc.action.TintAction.html">cc.action.TintAction</a>
						</li>
						
						<li>
							<a href="cc.game.Game.html">cc.game.Game</a>
						</li>
						
						<li>
							<a href="cc.input.InputManager.html">cc.input.InputManager</a>
						</li>
						
						<li>
							<a href="cc.input.InputManagerEvent.html">cc.input.InputManagerEvent</a>
						</li>
						
						<li>
							<a href="cc.input.KeyActionInfo.html">cc.input.KeyActionInfo</a>
						</li>
						
						<li>
							<a href="cc.input.KeyboardCursor.html">cc.input.KeyboardCursor</a>
						</li>
						
						<li>
							<a href="cc.input.KeyboardInputManager.html">cc.input.KeyboardInputManager</a>
						</li>
						
						<li>
							<a href="cc.input.KeyInfo.html">cc.input.KeyInfo</a>
						</li>
						
						<li>
							<a href="cc.input.MouseInputManager.html">cc.input.MouseInputManager</a>
						</li>
						
						<li>
							<a href="cc.input.MouseInputManagerEvent.html">cc.input.MouseInputManagerEvent</a>
						</li>
						
						<li>
							<a href="cc.input.PriorityInputNode.html">cc.input.PriorityInputNode</a>
						</li>
						
						<li>
							<a href="cc.input.SceneGraphInputTreeNode.html">cc.input.SceneGraphInputTreeNode</a>
						</li>
						
						<li>
							<a href="cc.math.Color.html">cc.math.Color</a>
						</li>
						
						<li>
							<a href="cc.math.Dimension.html">cc.math.Dimension</a>
						</li>
						
						<li>
							<a href="cc.math.Matrix3.html">cc.math.Matrix3</a>
						</li>
						
						<li>
							<a href="cc.math.Path.html">cc.math.Path</a>
						</li>
						
						<li>
							<a href="cc.math.path.ContainerSegment.html">cc.math.path.ContainerSegment</a>
						</li>
						
						<li>
							<a href="cc.math.path.SegmentArc.html">cc.math.path.SegmentArc</a>
						</li>
						
						<li>
							<a href="cc.math.path.SegmentBezier.html">cc.math.path.SegmentBezier</a>
						</li>
						
						<li>
							<a href="cc.math.path.SegmentCardinalSpline.html">cc.math.path.SegmentCardinalSpline</a>
						</li>
						
						<li>
							<a href="cc.math.path_.html#SegmentLine">cc.math.path.SegmentLine</a>
						</li>
						
						<li>
							<a href="cc.math.path.SegmentQuadratic.html">cc.math.path.SegmentQuadratic</a>
						</li>
						
						<li>
							<a href="cc.math.path.SubPath.html">cc.math.path.SubPath</a>
						</li>
						
						<li>
							<a href="cc.math.Rectangle.html">cc.math.Rectangle</a>
						</li>
						
						<li>
							<a href="cc.math.Vector.html">cc.math.Vector</a>
						</li>
						
						<li>
							<a href="cc.node.Director.html">cc.node.Director</a>
						</li>
						
						<li>
							<a href="cc.node.FastSprite.html">cc.node.FastSprite</a>
						</li>
						
						<li>
							<a href="cc.node.Node.html">cc.node.Node</a>
						</li>
						
						<li>
							<a href="cc.node.Scene.html">cc.node.Scene</a>
						</li>
						
						<li>
							<a href="cc.node.Sprite_.html">cc.node.Sprite</a>
						</li>
						
						<li>
							<a href="cc.node.sprite.Animation.html">cc.node.sprite.Animation</a>
						</li>
						
						<li>
							<a href="cc.node.sprite.AnimationCache.html">cc.node.sprite.AnimationCache</a>
						</li>
						
						<li>
							<a href="cc.node.sprite.SpriteFrame.html">cc.node.sprite.SpriteFrame</a>
						</li>
						
						<li>
							<a href="cc.plugin.asset.AssetManager.html">cc.plugin.asset.AssetManager</a>
						</li>
						
						<li>
							<a href="cc.plugin.audio.AudioEffect.html">cc.plugin.audio.AudioEffect</a>
						</li>
						
						<li>
							<a href="cc.plugin.audio.AudioManager.html">cc.plugin.audio.AudioManager</a>
						</li>
						
						<li>
							<a href="cc.plugin.font.FontMetrics.html">cc.plugin.font.FontMetrics</a>
						</li>
						
						<li>
							<a href="cc.plugin.font.SpriteFont.html">cc.plugin.font.SpriteFont</a>
						</li>
						
						<li>
							<a href="cc.plugin.font.SpriteFontChar.html">cc.plugin.font.SpriteFontChar</a>
						</li>
						
						<li>
							<a href="cc.plugin.layout.BorderLayout.html">cc.plugin.layout.BorderLayout</a>
						</li>
						
						<li>
							<a href="cc.plugin.layout.Gap.html">cc.plugin.layout.Gap</a>
						</li>
						
						<li>
							<a href="cc.plugin.layout.GridLayout.html">cc.plugin.layout.GridLayout</a>
						</li>
						
						<li>
							<a href="cc.plugin.layout.Insets.html">cc.plugin.layout.Insets</a>
						</li>
						
						<li>
							<a href="cc.plugin.layout.LayerLayout.html">cc.plugin.layout.LayerLayout</a>
						</li>
						
						<li>
							<a href="cc.plugin.layout.Layout.html">cc.plugin.layout.Layout</a>
						</li>
						
						<li>
							<a href="cc.plugin.layout.Unit.html">cc.plugin.layout.Unit</a>
						</li>
						
						<li>
							<a href="cc.plugin.loader.Loader.html">cc.plugin.loader.Loader</a>
						</li>
						
						<li>
							<a href="cc.plugin.loader.ResourceLoaderAudioBuffer.html">cc.plugin.loader.ResourceLoaderAudioBuffer</a>
						</li>
						
						<li>
							<a href="cc.plugin.loader.ResourceLoaderImage.html">cc.plugin.loader.ResourceLoaderImage</a>
						</li>
						
						<li>
							<a href="cc.plugin.loader.ResourceLoaderJSON.html">cc.plugin.loader.ResourceLoaderJSON</a>
						</li>
						
						<li>
							<a href="cc.plugin.loader.ResourceLoaderXML.html">cc.plugin.loader.ResourceLoaderXML</a>
						</li>
						
						<li>
							<a href="cc.plugin.texture.TexturePacker.html">cc.plugin.texture.TexturePacker</a>
						</li>
						
						<li>
							<a href="cc.plugin.texture.TexturePackerNode.html">cc.plugin.texture.TexturePackerNode</a>
						</li>
						
						<li>
							<a href="cc.plugin.texture.TexturePackerPage.html">cc.plugin.texture.TexturePackerPage</a>
						</li>
						
						<li>
							<a href="cc.render.CanvasRenderer.html">cc.render.CanvasRenderer</a>
						</li>
						
						<li>
							<a href="cc.render.DecoratedWebGLRenderingContext.html">cc.render.DecoratedWebGLRenderingContext</a>
						</li>
						
						<li>
							<a href="cc.render.GeometryBatcher.html">cc.render.GeometryBatcher</a>
						</li>
						
						<li>
							<a href="cc.render.Pattern.html">cc.render.Pattern</a>
						</li>
						
						<li>
							<a href="cc.render.Renderer.html">cc.render.Renderer</a>
						</li>
						
						<li>
							<a href="cc.render.RenderingContextSnapshot.html">cc.render.RenderingContextSnapshot</a>
						</li>
						
						<li>
							<a href="cc.render.ScaleManager.html">cc.render.ScaleManager</a>
						</li>
						
						<li>
							<a href="cc.render.shader.AbstractShader.html">cc.render.shader.AbstractShader</a>
						</li>
						
						<li>
							<a href="cc.render.shader.Attribute.html">cc.render.shader.Attribute</a>
						</li>
						
						<li>
							<a href="cc.render.shader.MatrixUniform.html">cc.render.shader.MatrixUniform</a>
						</li>
						
						<li>
							<a href="cc.render.shader.SolidColorShader.html">cc.render.shader.SolidColorShader</a>
						</li>
						
						<li>
							<a href="cc.render.shader.TextureShader.html">cc.render.shader.TextureShader</a>
						</li>
						
						<li>
							<a href="cc.render.shader.TextureUniform.html">cc.render.shader.TextureUniform</a>
						</li>
						
						<li>
							<a href="cc.render.shader.Uniform.html">cc.render.shader.Uniform</a>
						</li>
						
						<li>
							<a href="cc.render.Texture2D.html">cc.render.Texture2D</a>
						</li>
						
						<li>
							<a href="cc.render.WebGLRenderer.html">cc.render.WebGLRenderer</a>
						</li>
						
						<li>
							<a href="cc.transition.Transition.html">cc.transition.Transition</a>
						</li>
						
						<li>
							<a href="cc.transition.TransitionFade.html">cc.transition.TransitionFade</a>
						</li>
						
						<li>
							<a href="cc.transition.TransitionMove.html">cc.transition.TransitionMove</a>
						</li>
						
						<li>
							<a href="cc.transition.TransitionSlideInB.html">cc.transition.TransitionSlideInB</a>
						</li>
						
						<li>
							<a href="cc.transition.TransitionSlideInL.html">cc.transition.TransitionSlideInL</a>
						</li>
						
						<li>
							<a href="cc.transition.TransitionSlideInR.html">cc.transition.TransitionSlideInR</a>
						</li>
						
						<li>
							<a href="cc.transition.TransitionSlideInT.html">cc.transition.TransitionSlideInT</a>
						</li>
						
						<li>
							<a href="cc.util.Resource.html">cc.util.Resource</a>
						</li>
						
						<li>
							<a href="cc.widget.Button.html">cc.widget.Button</a>
						</li>
						
						<li>
							<a href="cc.widget.Label.html">cc.widget.Label</a>
						</li>
						

					</ul>
				</li>
				
				<li class="dropdown">
					<a href="global.html" class="dropdown-toggle" data-toggle="dropdown">Global<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="global.html#__extends">__extends</a>
						</li>
						
						<li>
							<a href="global.html#test">test</a>
						</li>
						

					</ul>
				</li>
				
			</ul>
		</div>
	</div>

	<div class="row-fluid">

		
			<div class="span12">
				
				<div id="main">
					


		<h1 class="page-title">Source: render/GeometryBatcher.js</h1>
    
<section>
	<article>
		<pre
			class="sunlight-highlight-javascript linenums">/**
 * License: see license.txt file.
 */
/// &lt;reference path="../math/Point.ts"/>
/// &lt;reference path="../math/Color.ts"/>
/// &lt;reference path="../math/Matrix3.ts"/>
/// &lt;reference path="../node/Sprite.ts"/>
/// &lt;reference path="./RenderingContextSnapshot.ts"/>
/// &lt;reference path="./WebGLState.ts"/>
/// &lt;reference path="./shader/AbstractShader.ts"/>
/// &lt;reference path="./shader/Buffer.ts"/>
var cc;
(function (_cc) {
    var render;
    (function (render) {
        "use strict";
        var Matrix3 = cc.math.Matrix3;
        var Buffer = cc.render.shader.Buffer;
        var __vv = { x: 0, y: 0 };
        var __color = new Uint8Array([0, 0, 0, 0]);
        /**
         * @class cc.render.GeometryBatcher
         * @classdesc
         *
         * This class handles geometry, batches it into ping-pong'ed buffers and signals when to flush.
         */
        var GeometryBatcher = (function () {
            /**
             * Build a new GeometryBatcher instance. You probably will need one of this.
             * @method cc.render.GeometryBatcher#constructor
             * @param _gl {WebGLRenderingContext}
             */
            function GeometryBatcher(glstate) {
                /**
                 * WebGL geometry, color and uv buffer ids.
                 * @member cc.render.GeometryBatcher#_glDataBuffers;
                 * @type {Array&lt;WebGLBuffer>}
                 * @private
                 */
                this._glDataBuffers = [];
                /**
                 * WebGL indices buffer ids.
                 * @member cc.render.GeometryBatcher#_glIndexBuffers;
                 * @type {Array&lt;WebGLBuffer>}
                 * @private
                 */
                this._glIndexBuffers = [];
                /**
                 * Batching buffers index.
                 * @member cc.render.GeometryBatcher#_currentBuffersIndex
                 * @type {number}
                 * @private
                 */
                this._currentBuffersIndex = 0;
                /**
                 * Main rendering buffer as buffer array (abstract version).
                 * @member cc.render.GeometryBatcher#_dataArrayBuffer
                 * @type {ArrayBuffer}
                 * @private
                 */
                this._dataArrayBuffer = null;
                /**
                 * Current rendering buffer as Float32 array
                 * @member cc.render.GeometryBatcher#_dataBufferFloat
                 * @type {Float32Array}
                 * @private
                 */
                this._dataBufferFloat = null;
                /**
                 * Current rendering buffer as Uint8 array.
                 * @member cc.render.GeometryBatcher#_dataBufferByte
                 * @type {Uint8Array}
                 * @private
                 */
                this._dataBufferByte = null;
                /**
                 * Current rendering buffer as Uint32 array.
                 * @member cc.render.GeometryBatcher#_dataBufferUint
                 * @type {Uint8Array}
                 * @private
                 */
                this._dataBufferUint = null;
                /**
                 * Current Buffer index.
                 * @member cc.render.GeometryBatcher#_dataBufferIndex
                 * @type {number}
                 * @private
                 */
                this._dataBufferIndex = 0;
                /**
                 * Current rendering buffer for geometry indices.
                 * @member cc.render.GeometryBatcher#_indexBuffer
                 * @type {Float32Array}
                 * @private
                 */
                this._indexBuffer = null;
                /**
                 * Current Buffer index.
                 * @member cc.render.GeometryBatcher#_indexBufferIndex
                 * @type {number}
                 * @private
                 */
                this._indexBufferIndex = 0;
                /**
                 * The canvas WebGLRenderingContext
                 * @member cc.render.GeometryBatcher#_gl
                 * @type {WebGLRenderingContext}
                 */
                this._gl = null;
                this._gl = glstate._gl;
                this._dataArrayBuffer = new ArrayBuffer(GeometryBatcher.MAX_QUADS * 40 * 4);
                this._dataBufferFloat = new Float32Array(this._dataArrayBuffer); // 40 is fastshader vertex size.
                this._dataBufferByte = new Uint8Array(this._dataArrayBuffer);
                this._dataBufferUint = new Uint32Array(this._dataArrayBuffer);
                this._indexBuffer = new Uint16Array(GeometryBatcher.MAX_QUADS * 6);
                // preset geometry indices.
                var indexBufferIndex = 0;
                var elementIndex = 0;
                var indexBuffer = this._indexBuffer;
                for (var i = 0; i &lt; GeometryBatcher.MAX_QUADS; i++) {
                    indexBuffer[indexBufferIndex] = elementIndex;
                    indexBuffer[indexBufferIndex + 1] = elementIndex + 1;
                    indexBuffer[indexBufferIndex + 2] = elementIndex + 2;
                    indexBuffer[indexBufferIndex + 3] = elementIndex;
                    indexBuffer[indexBufferIndex + 4] = elementIndex + 2;
                    indexBuffer[indexBufferIndex + 5] = elementIndex + 3;
                    indexBufferIndex += 6;
                    elementIndex += 4;
                }
                this._glDataBuffers.push(new Buffer(this._gl, this._gl.ARRAY_BUFFER, this._dataBufferFloat, this._gl.DYNAMIC_DRAW));
                this._glDataBuffers.push(new Buffer(this._gl, this._gl.ARRAY_BUFFER, this._dataBufferFloat, this._gl.DYNAMIC_DRAW));
                this._glDataBuffers.push(new Buffer(this._gl, this._gl.ARRAY_BUFFER, this._dataBufferFloat, this._gl.DYNAMIC_DRAW));
                this._glDataBuffers.push(new Buffer(this._gl, this._gl.ARRAY_BUFFER, this._dataBufferFloat, this._gl.DYNAMIC_DRAW));
                this._glIndexBuffers.push(new Buffer(this._gl, this._gl.ELEMENT_ARRAY_BUFFER, this._indexBuffer, this._gl.STATIC_DRAW));
                this._glIndexBuffers.push(new Buffer(this._gl, this._gl.ELEMENT_ARRAY_BUFFER, this._indexBuffer, this._gl.STATIC_DRAW));
                this._glIndexBuffers.push(new Buffer(this._gl, this._gl.ELEMENT_ARRAY_BUFFER, this._indexBuffer, this._gl.STATIC_DRAW));
                this._glIndexBuffers.push(new Buffer(this._gl, this._gl.ELEMENT_ARRAY_BUFFER, this._indexBuffer, this._gl.STATIC_DRAW));
                this._glDataBuffer = this._glDataBuffers[0];
                this._glIndexBuffer = this._glIndexBuffers[0];
            }
            GeometryBatcher.prototype.batchRectGeometryWithTexture = function (vertices, u0, v0, u1, v1, rcs) {
                var tint = rcs._tintColor;
                var r = tint[0];
                var g = tint[1];
                var b = tint[2];
                var a = tint[3] * rcs._globalAlpha;
                this.batchVertex(vertices[0], r, g, b, a, u0, v0);
                this.batchVertex(vertices[1], r, g, b, a, u1, v0);
                this.batchVertex(vertices[2], r, g, b, a, u1, v1);
                this.batchVertex(vertices[3], r, g, b, a, u0, v1);
                // add two triangles * 3 values each.
                this._indexBufferIndex += 6;
                return this._dataBufferIndex + 32 >= this._dataBufferFloat.length;
            };
            /**
             * Batch a rectangle with texture info and tint color.
             * Tint color will be modified by currently alpha value set.
             * @member cc.render.GeometryBatcher#batchRectWithTexture
             * @param x {number} rectangle position
             * @param y {number}
             * @param w {number} rectangle size
             * @param h {number}
             * @param rcs {RenderingContextSnapshot} current rendering context snapshot info
             * @param u0 {number} texture position
             * @param v0 {number}
             * @param u1 {number} texture size
             * @param v1 {number}
             */
            GeometryBatcher.prototype.batchRectWithTexture = function (x, y, w, h, rcs, u0, v0, u1, v1) {
                var tint = rcs._tintColor;
                var r = tint[0];
                var g = tint[1];
                var b = tint[2];
                var a = tint[3] * rcs._globalAlpha;
                var cm = rcs._currentMatrix;
                __vv.x = x;
                __vv.y = y;
                this.batchVertex(Matrix3.transformPoint(cm, __vv), r, g, b, a, u0, v0);
                __vv.x = x + w;
                __vv.y = y;
                this.batchVertex(Matrix3.transformPoint(cm, __vv), r, g, b, a, u1, v0);
                __vv.x = x + w;
                __vv.y = y + h;
                this.batchVertex(Matrix3.transformPoint(cm, __vv), r, g, b, a, u1, v1);
                __vv.x = x;
                __vv.y = y + h;
                this.batchVertex(Matrix3.transformPoint(cm, __vv), r, g, b, a, u0, v1);
                // add two triangles * 3 values each.
                this._indexBufferIndex += 6;
                return this._dataBufferIndex + 32 >= this._dataBufferFloat.length;
            };
            /**
             * Batch a rect with the current rendering info. The rect color will be tinted. Resulting transparency value will
             * be modified by currently rendering context alpha value set.
             * @method cc.render.GeometryBatcher#batchRect
             * @param x {number}
             * @param y {number}
             * @param w {number}
             * @param h {number}
             * @param rcs {cc.render.RenderingContextSnapshot} current rendering context snapshot info
             */
            GeometryBatcher.prototype.batchRect = function (x, y, w, h, rcs) {
                var color = rcs._fillStyleColor;
                var tint = rcs._tintColor;
                var r = color[0] * tint[0];
                var g = color[1] * tint[1];
                var b = color[2] * tint[2];
                var a = color[3] * tint[3] * rcs._globalAlpha;
                var cm = rcs._currentMatrix;
                __vv.x = x;
                __vv.y = y;
                this.batchVertex(Matrix3.transformPoint(cm, __vv), r, g, b, a, 0, 0);
                __vv.x = x + w;
                __vv.y = y;
                this.batchVertex(Matrix3.transformPoint(cm, __vv), r, g, b, a, 0, 0);
                __vv.x = x + w;
                __vv.y = y + h;
                this.batchVertex(Matrix3.transformPoint(cm, __vv), r, g, b, a, 0, 0);
                __vv.x = x;
                __vv.y = y + h;
                this.batchVertex(Matrix3.transformPoint(cm, __vv), r, g, b, a, 0, 0);
                // add two triangles * 3 values each.
                this._indexBufferIndex += 6;
                return this._dataBufferIndex + 32 >= this._dataBufferFloat.length;
            };
            /**
             * Batch a vertex with color and texture.
             * @method cc.render.GeometryBatcher#batchVertex
             * @param p {Point}
             * @param r {number}
             * @param g {number}
             * @param b {number}
             * @param a {number}
             * @param u {number}
             * @param v {number}
             */
            GeometryBatcher.prototype.batchVertex = function (p, r, g, b, a, u, v) {
                this._dataBufferFloat[this._dataBufferIndex++] = p.x;
                this._dataBufferFloat[this._dataBufferIndex++] = p.y;
                this._dataBufferFloat[this._dataBufferIndex++] = r;
                this._dataBufferFloat[this._dataBufferIndex++] = g;
                this._dataBufferFloat[this._dataBufferIndex++] = b;
                this._dataBufferFloat[this._dataBufferIndex++] = a;
                this._dataBufferFloat[this._dataBufferIndex++] = u;
                this._dataBufferFloat[this._dataBufferIndex++] = v;
            };
            /**
             * Flush currently batched geometry and related info with a given shader program.
             * @method cc.render.GeometryBatcher#flush
             * @param shader {cc.render.shader.AbstractShader} program shader
             * @param rcs {cc.render.RenderingContextSnapshot}
             */
            GeometryBatcher.prototype.flush = function (shader, rcs) {
                if (!this._indexBufferIndex) {
                    return;
                }
                // simply rebind the buffer, not modify its contents.
                this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER, this._glIndexBuffer._buffer);
                //this._glDataBuffer.forceEnableWithValue(this._dataBufferFloat);
                this._glDataBuffer.forceEnableWithValue(this._dataBufferFloat.subarray(0, this._dataBufferIndex));
                //this._glDataBuffer.enableWithValue(this._dataBufferFloat.subarray(0, this._dataBufferIndex));
                shader.flushBuffersWithContent(rcs);
                this._gl.drawElements(this._gl.TRIANGLES, this._indexBufferIndex, this._gl.UNSIGNED_SHORT, 0);
                //this._gl.drawArrays(this._gl.TRIANGLE_STRIP, 0, 4);
                // reset buffer data index.
                this._dataBufferIndex = 0;
                this._indexBufferIndex = 0;
                // ping pong rendering buffer.
                this._currentBuffersIndex = (this._currentBuffersIndex + 1) &amp; 3;
                this._glDataBuffer = this._glDataBuffers[this._currentBuffersIndex];
                this._glIndexBuffer = this._glIndexBuffers[this._currentBuffersIndex];
            };
            GeometryBatcher.prototype.__uintColor = function (rcs) {
                var tint = rcs._tintColor;
                var r = (tint[0] * 255) | 0;
                var g = (tint[1] * 255) | 0;
                var b = (tint[2] * 255) | 0;
                var a = (tint[3] * rcs._globalAlpha * 255) | 0;
                return (r) | (g &lt;&lt; 8) | (b &lt;&lt; 16) | (a &lt;&lt; 24);
            };
            GeometryBatcher.prototype.batchRectGeometryWithSpriteFast = function (sprite, u0, v0, u1, v1, rcs) {
                var cc = this.__uintColor(rcs);
                var db = this._dataBufferFloat;
                var dbuint = this._dataBufferUint;
                var dbi = this._dataBufferIndex;
                //var w0 = (sprite._contentSize.width ) * (1-sprite._transformationAnchor.x);
                //var w1 = (sprite._contentSize.width ) * -sprite._transformationAnchor.x;
                //
                //var h1 = sprite._contentSize.height * (1-sprite._transformationAnchor.y);
                //var h0 = sprite._contentSize.height * -sprite._transformationAnchor.y;
                dbuint[dbi + 2] = dbuint[dbi + 12] = dbuint[dbi + 22] = dbuint[dbi + 32] = cc;
                db[dbi] = db[dbi + 10] = db[dbi + 20] = db[dbi + 30] = sprite.x;
                db[dbi + 1] = db[dbi + 11] = db[dbi + 21] = db[dbi + 31] = sprite.y;
                db[dbi + 7] = db[dbi + 17] = db[dbi + 27] = db[dbi + 37] = sprite.rotationAngle;
                db[dbi + 8] = db[dbi + 18] = db[dbi + 28] = db[dbi + 38] = sprite.scaleX;
                db[dbi + 9] = db[dbi + 19] = db[dbi + 29] = db[dbi + 39] = sprite.scaleY;
                var w0 = sprite.width / 2.0;
                var w1 = -w0;
                var h1 = sprite.height / 2.0;
                var h0 = -h1;
                db[dbi + 3] = u0;
                db[dbi + 4] = v0;
                db[dbi + 5] = w0;
                db[dbi + 6] = h0;
                db[dbi + 13] = u1;
                db[dbi + 14] = v0;
                db[dbi + 15] = w1;
                db[dbi + 16] = h0;
                db[dbi + 23] = u1;
                db[dbi + 24] = v1;
                db[dbi + 25] = w1;
                db[dbi + 26] = h1;
                db[dbi + 33] = u0;
                db[dbi + 34] = v1;
                db[dbi + 35] = w0;
                db[dbi + 36] = h1;
                // add two triangles * 3 values each.
                this._indexBufferIndex += 6;
                this._dataBufferIndex += 40;
                return this._dataBufferIndex + 40 >= this._dataBufferFloat.length;
            };
            /**
             * Max bufferable quads.
             * @member cc.render.GeometryBatcher.MAX_QUADS
             * @type {number}
             */
            GeometryBatcher.MAX_QUADS = 26214; // 1Mb/40
            return GeometryBatcher;
        })();
        render.GeometryBatcher = GeometryBatcher;
    })(render = _cc.render || (_cc.render = {}));
})(cc || (cc = {}));
</pre>
	</article>
</section>





				</div>

				<div class="clearfix"></div>
				<footer>
					
					@hyperandroid
					<br />
					
					
		<span class="copyright">
		Chukong inc. 2014
		</span>
					<br />
					
		<span class="jsdoc-message">
		Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha5</a>
		on 23/Tu/2015 using the <a
			href="https://github.com/terryweiss/docstrap">DocStrap template</a>.
		</span>
				</footer>
			</div>

			
			<br clear="both">
		</div>

	</div>
	<!--<script src="scripts/sunlight.js"></script>-->
	<script src="scripts/docstrap.lib.js"></script>
	<script src="scripts/bootstrap-dropdown.js"></script>
	<script src="scripts/toc.js"></script>

	<script>
		$( function () {
			$( "[id*='$']" ).each( function () {
				var $this = $( this );

				$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
			} );

			$( "#toc" ).toc( {
				anchorName  : function ( i, heading, prefix ) {
					return $( heading ).attr( "id" ) || ( prefix + i );
				},
				selectors   : "h1,h2,h3,h4",
				showAndHide : false,
				scrollTo    : "100px"
			} );

			$( "#toc>ul" ).addClass( "nav nav-pills nav-stacked" );
			$( "#main span[id^='toc']" ).addClass( "toc-shim" );
			$( '.dropdown-toggle' ).dropdown();
//			$( ".tutorial-section pre, .readme-section pre" ).addClass( "sunlight-highlight-javascript" ).addClass( "linenums" );

			$( ".tutorial-section pre, .readme-section pre" ).each( function () {
				var $this = $( this );

				var example = $this.find( "code" );
				exampleText = example.html();
				var lang = /{@lang (.*?)}/.exec( exampleText );
				if ( lang && lang[1] ) {
					exampleText = exampleText.replace( lang[0], "" );
					example.html( exampleText );
					lang = lang[1];
				} else {
					lang = "javascript";
				}

				if ( lang ) {

					$this
						.addClass( "sunlight-highlight-" + lang )
						.addClass( "linenums" )
						.html( example.html() );

				}
			} );

			Sunlight.highlightAll( {
				lineNumbers : true,
				showMenu : true,
				enableDoclinks : true
			} );
		} );
	 </script>



	<!--Navigation and Symbol Display-->
	


	<!--Google Analytics-->
	

</body>
</html>
